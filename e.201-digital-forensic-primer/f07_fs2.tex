% DO NOT COMPILE THIS FILE DIRECTLY!
% This is included by the other .tex files.


\begin{frame}
    \includegraphics[scale=0.3]{images/logo-circl-Forensics.png}
    \begin{itemize}
        \item[]
        \item[]
        \item[] 7. File System Analysis - NTFS
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.1 NTFS}
    \begin{itemize}
	    \item Layout
  \begin{lstlisting}[basicstyle=\tiny]
--------------------------------
|      Volume Boot Record      |     -- Similar to FAT
--------------------------------
|          MFT Mirror          |     -- First 4 MFT entries
--------------------------------
|                              |
|         Data Clusters        |
|                              |
--------------------------------
|       Master File Table      |     -- MFT
--------------------------------
|                              |
|         Data Clusters        |
|                              |
--------------------------------
|      Backup Boot Record      |
--------------------------------
  \end{lstlisting}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.1 NTFS}
    \begin{itemize}
    \item Master File Table
        \begin{itemize}
	    \item 1 record per file/directory
	    \item 1024 Bytes (2 sectors) per record
	    \item 4 MFT records per cluster (8 sectors usually)
	    \item Everything is a file (NTFS Metadata)
        \end{itemize}
	\item NTFS Meta Files
  \begin{lstlisting}[basicstyle=\tiny]
Entry      Filename        Description
-------------------------------------------------------
  0        $MFT            MFT self reference
  1        $MFTMirr        Backup first 4 MFT entries
  2        $LogFile        Journal
  3        $Volume         Volume info lable, version
  4        $AttrDef        Attribute definitions
  5                        Root Directory
  6        $Bitmap         Allocation status for each cluster
  7        $Boot           Boot Sector and boot code
  8        $BadClus        Bas Clusters
  ...
  23
-------------------------------------------------------
  \end{lstlisting}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.1 NTFS}
    \begin{itemize}
	    \item MFT Record
  \begin{lstlisting}[basicstyle=\tiny]
      MFT Record Header                                 Attributes
|---------- ---------- ---------- ---------- ----|-----     ------------|
|FILE                                            |     .....            |
|---------- ---------- ---------- ---------- ----|-----     ------------|
 0   4                                         55 56                 1023
  \end{lstlisting}
    \item MFT Attributes
  \begin{lstlisting}[basicstyle=\tiny]
         Attribute Header                        Data Stream
|---------- ---------- ----------|-----     ---------- ---------- ------------|
|                                |     .....                                  |
|---------- ---------- ----------|-----     ---------- ---------- ------------|
     Size depends on attribute              Resident or Non-resident
  \end{lstlisting}
    \item Important Attributes
        \begin{itemize}
		\item \texttt{\$10 - \$STANDARD\_INFORMATION}
		\item \texttt{\$30 - \$FILE\_NAME}
		\item \texttt{\$80 - \$DATA}
		\item[] .....
        \end{itemize}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.2 File System Timeline}
    \begin{itemize}
        \item MAC time stamps
            \begin{itemize}
                \item M-time: Content last modified
                \item A-time: Content last accessed
                \item C-time: Meta data last modified
                \item B-time: File created
            \end{itemize}
        \item[]
        \item[] Exercise: Create a timeline from image \texttt{'deleted.dd'}
    \end{itemize}
  \begin{lstlisting}[basicstyle=\tiny]
# mkdir time

# fls -f ntfs -m/ -r deleted.dd > time/D.body
	-m/   time machine format and mountpoint
	-r    recursive

# cd time
# mactime -b D.body > D.time
# less D.time
  \end{lstlisting}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.2 File System Timeline}
    \begin{itemize}
        \item[] Exercise: Timeline analysis
  \begin{lstlisting}[basicstyle=\tiny]
Thu Jun 27 2013 12:23:08      113 ...b         35-128-1 c:/time-01.txt
Thu Jun 27 2013 12:24:20       75 m.cb         37-128-1 c:/time-02.txt
Thu Jun 27 2013 12:25:24       75 m.cb         38-128-1 c:/time-03.txt
                               75 m...         41-128-1 c:/time-03 - Copy.txt
Thu Jun 27 2013 12:26:05       75 m..b         39-128-1 c:/time-44.txt
Thu Jun 27 2013 12:27:00       75 macb         40-128-1 c:/time-05.txt (deleted)
Thu Jun 27 2013 12:33:50      113 m.c.         35-128-1 c:/time-01.txt
Thu Jun 27 2013 13:07:52       75 .acb         41-128-1 c:/time-03 - Copy.txt
Thu Jun 27 2013 13:10:36       75 ..c.         39-128-1 c:/time-44.txt
Thu Jun 27 2013 13:14:20       20 m...         42-128-1 c:/time-06.txt
Thu Jun 27 2013 13:56:30       20 .acb         42-128-1 c:/time-06.txt
  \end{lstlisting}
        \item[] Scope on files:
  \begin{lstlisting}[basicstyle=\tiny]
Thu Jun 27 2013 12:23:08      113 ...b         35-128-1 c:/time-01.txt
Thu Jun 27 2013 12:33:50      113 m.c.         35-128-1 c:/time-01.txt

Thu Jun 27 2013 12:24:20       75 m.cb         37-128-1 c:/time-02.txt

Thu Jun 27 2013 12:25:24       75 m.cb         38-128-1 c:/time-03.txt
                               75 m...         41-128-1 c:/time-03 - Copy.txt
Thu Jun 27 2013 13:07:52       75 .acb         41-128-1 c:/time-03 - Copy.txt
  \end{lstlisting}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.2 File System Timeline}
    \begin{itemize}
        \item[] Exercise: Timeline analysis
  \begin{lstlisting}[basicstyle=\tiny]
Thu Jun 27 2013 12:23:08      113 ...b         35-128-1 c:/time-01.txt
Thu Jun 27 2013 12:24:20       75 m.cb         37-128-1 c:/time-02.txt
Thu Jun 27 2013 12:25:24       75 m.cb         38-128-1 c:/time-03.txt
                               75 m...         41-128-1 c:/time-03 - Copy.txt
Thu Jun 27 2013 12:26:05       75 m..b         39-128-1 c:/time-44.txt
Thu Jun 27 2013 12:27:00       75 macb         40-128-1 c:/time-05.txt (deleted)
Thu Jun 27 2013 12:33:50      113 m.c.         35-128-1 c:/time-01.txt
Thu Jun 27 2013 13:07:52       75 .acb         41-128-1 c:/time-03 - Copy.txt
Thu Jun 27 2013 13:10:36       75 ..c.         39-128-1 c:/time-44.txt
Thu Jun 27 2013 13:14:20       20 m...         42-128-1 c:/time-06.txt
Thu Jun 27 2013 13:56:30       20 .acb         42-128-1 c:/time-06.txt
  \end{lstlisting}
        \item[] Scope on files:
  \begin{lstlisting}[basicstyle=\tiny]
Thu Jun 27 2013 12:26:05       75 m..b         39-128-1 c:/time-44.txt
Thu Jun 27 2013 13:10:36       75 ..c.         39-128-1 c:/time-44.txt

Thu Jun 27 2013 12:27:00       75 macb         40-128-1 c:/time-05.txt (deleted)

Thu Jun 27 2013 13:14:20       20 m...         42-128-1 c:/time-06.txt
Thu Jun 27 2013 13:56:30       20 .acb         42-128-1 c:/time-06.txt
  \end{lstlisting}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.2 File System Timeline}
  \begin{lstlisting}[basicstyle=\tiny]
Thu Jun 27 2013 12:23:08      113 ...b         35-128-1 c:/time-01.txt
Thu Jun 27 2013 12:24:20       75 m.cb         37-128-1 c:/time-02.txt
Thu Jun 27 2013 12:25:24       75 m.cb         38-128-1 c:/time-03.txt
                               75 m...         41-128-1 c:/time-03 - Copy.txt
Thu Jun 27 2013 12:26:05       75 m..b         39-128-1 c:/time-44.txt
Thu Jun 27 2013 12:27:00       75 macb         40-128-1 c:/time-05.txt (deleted)
Thu Jun 27 2013 12:33:50      113 m.c.         35-128-1 c:/time-01.txt
Thu Jun 27 2013 13:07:52       75 .acb         41-128-1 c:/time-03 - Copy.txt
Thu Jun 27 2013 13:10:36       75 ..c.         39-128-1 c:/time-44.txt
Thu Jun 27 2013 13:14:20       20 m...         42-128-1 c:/time-06.txt
Thu Jun 27 2013 13:56:30       20 .acb         42-128-1 c:/time-06.txt

 1. 12:23:08 time-01.txt -> new create
 2. 12:24:20 time-02.txt -> new create
 3. 12:25:24 time-03.txt -> new create
 4. 12:26:05 time-04.txt -> new create
 5. 12:27:00 time-05.txt -> new create

 6. 12:29:07 time-01.txt -> modified content
 7. 12:33:50 time-01.txt -> 2nd modification
 8. 12:29:50 time-02.txt -> open/access file
 9. 12:30:01 time-02.txt -> close

10. 13:07:52 time-03.txt -> copy to time-0003 - Copy.txt
11. 13:10:36 time-04.txt -> rename to time-0044.txt

12. 13:14:20 time-06.txt -> new created on other drive
13. 13:56:30 time-06.txt -> copy to local drive
14. 13:58:07 time-05.txt -> delete file
  \end{lstlisting}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.3 Alternate Data Streams - ADS}
    \begin{itemize}
       \item Exercise: Information Exfiltration: Are there hidden data?
            \begin{itemize}
                \item Windows Explorer
                \item Show hidden files
                \item CMD: \texttt{dir}
                \item Open the file
                \item
                \item Other ideas?
            \end{itemize}
       \item Answers:
  \begin{lstlisting}[basicstyle=\tiny]
>
>
>
>
  \end{lstlisting}
       \item Creating ADS:
  \begin{lstlisting}[basicstyle=\tiny]
>
>
>
>
>
  \end{lstlisting}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{7.3 Alternate Data Streams - ADS}
    \begin{itemize}
       \item Exercise: Information Exfiltration: Are there hidden data?
            \begin{itemize}
                \item Windows Explorer
                \item Show hidden files
                \item CMD: \texttt{dir}
                \item Open the file
                \item
                \item Other ideas?
            \end{itemize}
       \item Answers:
  \begin{lstlisting}[basicstyle=\tiny]
> dir /r          # Windows Vista +
>
> notepad G:\test.txt:123.txt
> mspaint G:\text.txt:123.jpg
  \end{lstlisting}
       \item Creating ADS:
  \begin{lstlisting}[basicstyle=\tiny]
> File name syntax: <filename.ext>:<stream-name.ext>
>
> type 123.txt >> G:\test.txt:123.txt
> type "C:\Documents and Settings\All Users\Documents\My Pictures\
>              Sample Pictures\Sunset.jpg >> test.txt:123.jpg
  \end{lstlisting}
    \end{itemize}
\end{frame}






