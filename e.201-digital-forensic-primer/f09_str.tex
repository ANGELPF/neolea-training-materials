% DO NOT COMPILE THIS FILE DIRECTLY!
% This is included by the other .tex files.


\begin{frame}
    \includegraphics[scale=0.3]{images/logo-circl-Forensics.png}
    \begin{itemize}
        \item[]
        \item[]
        \item[] 9. String Search
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{9.1 What is 'String Search'?}
    \begin{itemize}
       \item Search the disk image for known words
            \begin{itemize}
                \item Terms used in a secret document
                \item IBAN ot other banking details
                \item Email addresses or URLs
                \item File names or shell commands
		\item[]
            \end{itemize}
       \item Search thrue all the blocks
            \begin{itemize}
                \item Allocated blocks
                \item File slack
                \item Non allocated blocks
                \item Outside the partition borders
		\item[]
            \end{itemize}
       \item Goal
            \begin{itemize}
                \item Proof that the data was there once
                \item May even recover deleted files
                \item Identify intresting data that are close
            \end{itemize}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]
  \frametitle{9.2 Steps to do a String Search}
    \begin{enumerate}
       \item Identify block/cluster size
            \begin{itemize}
		\item[] \texttt{mmls, fsstat}
            \end{itemize}
       \item Search for the string and the offset
            \begin{itemize}
		\item[] \texttt{blkls | srch\_strings | grep }
            \end{itemize}
       \item Calculate block/cluster of the string
	    \begin{itemize}
		\item[] \texttt{xxxxxxxxxx / 4096 = yyyy}
            \end{itemize}
       \item Review block/cluster content
	    \begin{itemize}
		\item[] \texttt{blkcat}
            \end{itemize}
       \item Identify inode of the block/cluster
	    \begin{itemize}
		\item[] \texttt{ifind}
            \end{itemize}
       \item Identify associated file
	    \begin{itemize}
		\item[] \texttt{ffind}
            \end{itemize}
       \item Recover file
	    \begin{itemize}
		\item[] \texttt{icat}
		\item[] Or mount and copy file
            \end{itemize}
    \end{enumerate}
\end{frame}


\newcounter{saveenumi}
\newcommand{\seti}{\setcounter{saveenumi}{\value{enumi}}}
\newcommand{\conti}{\setcounter{enumi}{\value{saveenumi}}}
\resetcounteronoverlays{saveenumi}

\begin{frame}[fragile]
  \frametitle{9.3 Exercise: What about Paulas cat?}
    \begin{enumerate}
        \item Identify cluster size
        \begin{lstlisting}[basicstyle=\tiny]
mmls circl-dfir.dd

    1      Slot      Start        End          Length       Description
 000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
 001:  -------   0000000000   0000002047   0000002048   Unallocated
 002:  000:000   0000002048   0004917247   0004915200   NTFS / exFAT (0x07)



fsstat -o 2048 circl-dfir.dd

     File System Type: NTFS
     Volume Serial Number: 7B6E5F9427919882
     OEM Name: NTFS    
     Volume Name: CIRCL-DFIR
     Version: Windows XP

     .....

     Sector Size: 512
     Cluster Size: 4096
     Total Cluster Range: 0 - 614398
     Total Sector Range: 0 - 4915198
        \end{lstlisting}
    \seti
    \end{enumerate}
\end{frame}


\begin{frame}[fragile]
  \frametitle{9.3 Exercise: What about Paulas cat?}
    \begin{enumerate}
        \conti
        \item Search for the string \texttt{'Paula'}
        \begin{lstlisting}[basicstyle=\tiny]
blkls -e -o 2048 circl-dfir.dd | strings -a -td | grep -i paula

     157342 Paula's cat is fat.........
     157370 Paula's cat is fat.........
     .....
     157510 Paula's cat is fat.........
     157538 Paula's cat is fat.........
        \end{lstlisting}

        \item Calculate cluster of the string
        \begin{lstlisting}[basicstyle=\tiny]
echo $((157342/4096))
     38

echo $((157538/4096))
     38
        \end{lstlisting}

        \item Review cluster content
        \begin{lstlisting}[basicstyle=\tiny]
blkcat -o 2048 circl-dfir2dd 38 | strings
     .....
     Paula's cat is fat.........
     Paula's cat is fat.........
     Paula's cat is fat.........
     .....
        \end{lstlisting}
    \seti
    \end{enumerate}
\end{frame}


\begin{frame}[fragile]
  \frametitle{9.3 Exercise: What about Paulas cat?}
    \begin{enumerate}
        \conti
        \item Identify inode of the cluster
        \begin{lstlisting}[basicstyle=\tiny]
ifind -o 2048 -d 38 circl-dfir.dd 
  0-128-1
        \end{lstlisting}

        \item Identify associated file
        \begin{lstlisting}[basicstyle=\tiny]
ffind -o 2048 circl-dfir.dd 0-128-1
  //$MFT
        \end{lstlisting}

        \item Recover file
        \begin{lstlisting}[basicstyle=\tiny]
icat -o 2048 circl-dfir.dd 0-128-1 > MFT
        \end{lstlisting}
    \end{enumerate}
    \begin{itemize}
        \item[] Exercise: Manual approach - Learn from errors
        \begin{lstlisting}[basicstyle=\tiny]
dd if=circl-dfir.dd bs=4096 skip=38 count=1 | xxd | less
dd if=circl-dfir.dd bs=4096 skip=$((2048 + 38)) count=1 | xxd | less
dd if=circl-dfir.dd bs=4096 skip=$((2048/8 + 38)) count=1 | xxd | less
        \end{lstlisting}
        \end{itemize}
\end{frame}



